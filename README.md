# Итоговая проверочная работа

---

#### Демонстрационное задание

* Все исполняемые файлы расположены в папке ./bin
* Файлы Frontend-приложения расположены в папке ./frontend

---

!!! __ВАЖНОЕ ЗАМЕЧАНИЕ:__
В выражение **map** конфигурации NGINX необходимо добавить опцию **hostnames;**

Пример:
```
map $http_x_rpc_method $target_service {
   hostnames;

   math.*  math-service;
   default core-service;
}
```
---
1. В Docker Compose нужно сконфигурировать следующую инфраструктуру:
   * __loadbalancer__ - роутер/балансировщик нагрузки
   * __core-service__ - контейнер с запущенным сервисом __./bin/core-service__
   * __date-service__ - контейнер с запущенным сервисом __./bin/date-service__

!!! __ВАЖНОЕ ЗАМЕЧАНИЕ:__
В Docker файлах сервиса не забывайте использовать команду:
```
RUN chmod +x /путь/к/исполняемому/файлу
```
иначе могут быть проблемы с запуском контейнеров в системе Windows.

2. loadbalancer должен отвечать на запросы по адресу http://127.0.0.1:8080 (внутри контейнера сервис использует порт __:80__)

3. Сервисы __core-service__ и __date-service__ должны быть доступны только внутри Compose и принимать подключения на порту __:80__

4. Запрос по адресу __http://127.0.0.1:8080__ должен возвращать стартовую страницу frontend приложения. Файлы веб приложения расположены в папке __./frontend__. Необходимо смонтировать эту папку в контейнер и настроить правило маршрутизации для __location /__

5. Запросы по адресу __http://127.0.0.1:8080/rpc__ должны возвращать результаты вызовов к микросервисам __core-service__ и __date-service__

6. Правила RPC протокола:
   * Максимальный размер пакета - 48 байт
   * Время выполнения запроса - 1 секунда
   * Запросы только методом POST (ошибка: 405)
   * В запросе должны присутствовать следующие заголовки:
     * X-Client-Id: date-service-client (ошибка: 401)
     * X-Client-Credentials: <любая строка> (ошибка: 401)
     * X-Rpc-Method: <date.*> (ошибка: 400)
   * Тело запроса должно приходить в формате JSON (ошибка: 400)

7. Правила маршрутизации запросов для __location /rpc__
   * Все запросы удовлетворяющие правилу __date.*__ проксируются в сервис __date-service__
   * Все остальные запросы просируются в __core-service__

8. Правила RPC запросов: __date-service__ выполняет следующие функции:

* date.day
* date.month
* date.year
* date.time

В теле запроса необходимо отправить данные в формате JSON:
```
{
   "date": "now"
}
```
Ответ сервера на запрос с заголовком X-Rpc-Method: date.year
```
{
   "result": 2025
}
```
